language: python
dist: trusty
sudo: false
branches:
  except:
    - /^v\d+\.*$/
    - gh-pages
    - travis-*
    - /^untagged.*/
    - /^feature.*/
matrix:
  include:
  - python: "3.5"
    env:
    - FLAG=false
      TOXENV=py35
  - python: "3.6"
    env:
    - FLAG=true
      TOXENV=py36

install:
- travis_retry pip install tox

script:
- make clean test
- if [[ $FLAG == 'true' ]]; then pip install . && cartpole train -e 500 -f build/model/Cartpole-${TRAVIS_BUILD_NUMBER}.h5; fi

deploy:
- provider: gcs
  skip_cleanup: true
  access_key_id: "GCS_ACCESS_KEY_ID"
  secret_access_key: "GCS_SECRET_ACCESS_KEY"
  bucket: "cartpole"
  local-dir: build/model
  on:
    branch: master
    condition: $FLAG = true
